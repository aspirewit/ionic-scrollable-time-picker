!function(){var e={picker:"$/proton/multi-list-picker/picker.html"},t=angular.module("proton.multi-list-picker",[]);t.run(["$templateCache",function(t){t.put(e.picker,"<div class='proton-multi-list-picker {{attachment}}'>\n    <span ng-transclude class='proton-multi-list-picker-contents'></span>\n    <div class='before'></div>\n    <div class='container'>\n        <ul class='lists'>\n            <li class='toolbar'>\n                <a class='toolbar-button' ng-click='done({$model: model})'>Done</a>\n            </li>\n            <li class='before-lists' ng-init='first = false'></li>\n            <li ng-repeat='list in items track by $index'\n                class='list-container {{$index == 0 || first ? \"first\" : \"\"}} {{$index == items.length - 1 ? \"last\" : \"\"}}'\n                data-index='{{$index}}' proton-multi-list-motion data-motion-start='motionStart($event)'\n                data-motion-change='motionChange($event)' data-motion-end='motionEnd($event)'>\n            <span class='divider {{!list.value ? \"blank\" : \"\"}}' ng-if='list.$divider' ng-init='first = !list.value'>\n                <span ng-if='!bindHtml' ng-bind='list.value'></span>\n                <span ng-if='bindHtml' ng-bind-html='list.value'></span>\n            </span>\n                <ul class='list' ng-if='!list.$divider' data-selected='{{list.selected}}'>\n                    <li class='item {{item.index == list.selected ? \"selected\" : \"\"}} {{(!list.cycle && list.selected &lt; 3) ? \"offset-down-\" + (3 - list.selected) : \"\"}} {{(list.cycle ? item.cycleIndex : item.index) &lt; list.selected && (list.cycle ? item.cycleIndex : item.index) &gt;= list.selected - 3 ? \"distance-\" + (list.selected - (list.cycle ? item.cycleIndex : item.index)) : \"\"}} {{(list.cycle ? item.cycleIndex : item.index) &gt; list.selected && (list.cycle ? item.cycleIndex : item.index) &lt;= list.selected + 3 ? \"distance-\" + ((list.cycle ? item.cycleIndex : item.index) - list.selected) : \"\"}}'\n                        ng-repeat='item in list.view track by $index' data-index='{{item.index}}'\n                        ng-click='select(list, item.index)' style='width: {{list.width}}px;'>\n                        <span ng-if='item.$placeholder'></span>\n                        <span ng-if='!item.$placeholder && !bindHtml' ng-bind='item.label'></span>\n                        <span ng-if='!item.$placeholder && bindHtml' ng-bind-html='item.label'></span>\n                    </li>\n                </ul>\n            </li>\n            <li class='after-lists'></li>\n        </ul>\n    </div>\n    <div class='after'></div>\n</div>")}]),t.directive("protonMultiListPicker",["$parse",function(t){var n=function(e){e.items=[],this.addDivider=function(t){e.items.push({$divider:!0,value:t})},this.add=function(t){t.alias||(t.alias=e.items.length),t.index=e.items.length,e.items.push(t);var n=function(n){t.cached=n||[],e.$broadcast("protonMultiListPicker:changed",t)};t["static"]?n(t.source()):e.$watch(function(){return t.source()},n,!0)}};return{restrict:"E",replace:!0,templateUrl:e.picker,require:"?ngModel",scope:{done:"&?"},transclude:!0,controller:["$scope",n],link:function(e,n,i){var a=n.parent().scope(),l=t(i.ngModel);e.model=null,e.$watch(function(){return l(a)},function(t){t?e.model=t:e.model={},e.$broadcast("protonMultiListPicker:changed",t)},!0),e.$watch("model",function(t){e.$broadcast("protonMultiListPicker:changed",t)},!0),i.$observe("bindHtml",function(t){e.bindHtml="true"==t}),i.$observe("attachment",function(t){e.attachment=t||"inline"});var s={};e.$on("protonMultiListPicker:changed",function(){angular.forEach(s,function(t,n){var i=!1;angular.forEach(e.items,function(e){i=i||e.alias==n}),i||delete s[n]}),angular.forEach(e.items,function(e){if(!angular.isDefined(e.$divider)){angular.isObject(s[e.alias])||(s[e.alias]={});var t,i=angular.copy(e.cached);angular.isArray(i)?t=i:(t=[],angular.isObject(i)?(angular.forEach(i,function(e,n){t.push({label:e,value:n})}),t.sort(function(e,t){return e.label<t.label?-1:1})):t.push({label:i,value:i})),i=t,t=[],angular.forEach(i,function(e,n){e.index=n,angular.isObject(e)&&angular.isDefined(e.label)&&angular.isDefined(e.value)?t.push(e):t.push({label:e,value:e}),t[t.length-1].label=String(t[t.length-1].label)});var a=!1,l=0,c="";e.strictMatching?angular.forEach(t,function(t){!a&&angular.isDefined(s[e.alias][t.label])||(a=!0)}):(angular.forEach(t,function(t){if(!a){var n=t.label.replace(/<[^>]+>/g,"");!angular.isDefined(s[e.alias][t.label])&&s[e.alias].$$longestText&&s[e.alias].$$longestText.length<n.length&&(a=!0)}}),a||(s[e.alias]={},angular.forEach(t,function(t){s[e.alias][t.label]=!0}))),a?(s[e.alias]={},angular.forEach(t,function(t){var i=t.label;s[e.alias][i]=!0;var a=i.replace(/<[^>]+>/g,"");if(a.length>c.length){c=a;var r=document.createElement("div");r.innerHTML=i,r.className="sandbox-item",r.style.backgroundColor="red",n.append(r),l=Math.max(r.offsetWidth,l),r.parentNode.removeChild(r)}})):l=e.width,s[e.alias].$$longestText=c,e.width=l,e.array=t,e.selected=0}}),angular.isObject(e.model)&&(angular.forEach(e.items,function(t){t.$divider||angular.isUndefined(e.model[t.alias])&&(e.model[t.alias]=t.array.length?t.array[0].value:null)}),angular.forEach(e.items,function(t){t.$divider||(t.selected=-1,angular.forEach(t.array,function(n,i){t.selected>-1||n.value==e.model[t.alias]&&(t.selected=i)}),-1==t.selected&&(e.model[t.alias]=t.array.length?t.array[0].value:null,t.selected=0),e.$broadcast("protonMultiListPicker:selected",t))}))}),e.$on("protonMultiListPicker:selected",function(e,t){if(angular.isArray(t.array)){t.view=[];var n,i,a=Math.max(t.selected-3,0),l=Math.min(t.array.length-1,t.selected+3);for(n=a;l>=n;n++)i=angular.copy(t.array[n]),i.index=n,t.view.push(i);if(t.cycle){if(t.view.length<7&&t.array.length>0){var s,c=t.selected-a;for(s=t.array.length-1;3>c;){var r=angular.copy(t.array[s]);r||console.log(s),r.index=s,t.view.splice(0,0,r),s--,c++,0>s&&(s=t.array.length-1)}for(s=0;t.view.length<7;)i=angular.copy(t.array[s]),i.index=s,t.view.push(i),s++,s==t.array.length&&(s=0)}if(t.view.length>0){var o=t.view[3].index-3;angular.forEach(t.view,function(e){e.cycleIndex=o++})}}}}),function(){function t(t){var i=-1*Math.sign(t.speedY);0>i?l():a(),e.select(n,n.selected)}var n,i,a=function(){n.selected++,n.selected==n.array.length&&(n.cycle?n.selected=0:n.selected=n.array.length-1)},l=function(){n.selected--,n.selected<0&&(n.cycle?n.selected=n.array.length-1:n.selected=0)},s=function(e){for(var t=angular.element(e);t.length&&!t.hasClass("list-container");)t=t.parent();return t};e.motionStart=function(t){i=s(t.target);var a=i.attr("data-index");n=e.items[a],t.checkpoint()},e.motionChange=function(e){if(i){var n=i[0];if(n){var a=e.last();if(n=n.getElementsByTagName("li")[0]){var l=n.offsetHeight;Math.abs(a.y-e.y)>=l&&(e.checkpoint(),t(e))}}}},e.motionEnd=function(e){i&&i.length&&e.slowDown(1e-4,Math.min(Math.floor(Math.abs(e.speedY)/.3),8),function(){t(e)})}}(),e.select=function(t,n){angular.isObject(e.model)&&(e.model[t.alias]=t.array.length?t.array[n].value:null);var i=t.selected;t.selected=n,e.$broadcast("protonMultiListPicker:selected",t),e.$emit("protonMultiListPicker:selected",t,n,i)}}}}]),t.directive("protonMultiListPickerList",[function(){var e=function(e){e.items=[],this.add=function(t){e.items.push(t)}};return{scope:{source:"&?","static":"@?",alias:"@?",cycle:"@?",strictMatching:"@?"},restrict:"E",require:"^protonMultiListPicker",controller:["$scope",e],link:function(e,t,n,i){i.add({source:function(){return e.source?e.source():e.items},alias:e.alias,cycle:"true"==e.cycle,"static":!e.source||"false"!=e["static"],strictMatching:"true"==e.strictMatching})}}}]),t.directive("protonMultiListPickerDivider",[function(){return{restrict:"E",require:"^protonMultiListPicker",link:function(e,t,n,i){i.addDivider((t.html()||"").trim())}}}]),t.directive("protonMultiListPickerListItem",[function(){return{restrict:"E",require:"^protonMultiListPickerList",link:function(e,t,n,i){i.add({value:n.value||t.html(),label:t.html()})}}}]),t.service("protonMultiListMomentum",["$timeout",function(e){var t=function(t){var i={event:t,type:t.touches?"Touch":"Mouse",x:t.touches?t.touches[0].screenX:t.screenX,y:t.touches?t.touches[0].screenY:t.screenY,target:t.touches?t.touches[0].target:t.target,timestamp:Date.now(),xDisplacement:0,yDisplacement:0,speedX:0,speedY:0,speedXState:"stopped",speedYState:"stopped",accelerationX:0,accelerationY:0,speed:0,acceleration:0,angle:NaN,origin:n?n.origin?n.origin:n:null,remembered:n&&n.remembered?n.remembered:null};return i.checkpoint=function(){i.remembered=i},i.last=function(){return i.remembered},i.slowDown=function(t,n,a){var l=-1*Math.sign(i.speedX)*Math.abs(t),s=-1*Math.sign(i.speedY)*Math.abs(t),c=Math.abs(10*i.speedX/l/n),r=Math.abs(10*i.speedY/s/n),o=Math.max(c,r)/1e3,d=0;!function u(t){isNaN(t)||e(function(){angular.isFunction(a)&&a(d),d++,n>d&&u(1.1*t)},t)}(o)},i},n=null;this.start=function(e,i){e.touches&&e.touches.length>1||(n=t(e),angular.isFunction(i)&&i(n))},this.move=function(e,i){if(null!==n){var a=t(e),l=a.timestamp-n.timestamp,s=a.x-n.x,c=a.y-n.y;a.xDisplacement=s,a.yDisplacement=c,a.angle=Math.atan2(a.x,a.y),0==l?(0==s?(a.speedX=0,a.speedXState="stopped"):(a.speedX=Math.sign(s)*(1/0),a.speedXState="fast"),0==c?(a.speedY=0,a.speedYState="stopped"):(a.speedY=Math.sign(c)*(1/0),a.speedYState="fast")):(a.speedX=s/l,a.speedY=c/l,Math.abs(a.speedX)<.2?a.speedXState="slow":Math.abs(a.speedX)<.6?a.speedXState="moderate":a.speedXState="fast",Math.abs(a.speedY)<.2?a.speedYState="slow":Math.abs(a.speedY)<.6?a.speedYState="moderate":a.speedYState="fast");var r=a.speedX-n.speedX,o=a.speedY-n.speedY;0==l?(0==r?a.accelerationX=0:a.accelerationX=Math.sign(r)*(1/0),0==o?a.accelerationY=0:a.accelerationY=Math.sign(o)*(1/0)):(a.accelerationX=r/l,a.accelerationY=o/l),a.speed=Math.sqrt(Math.pow(a.speedX,2)+Math.pow(a.speedY,2)),a.acceleration=Math.sqrt(Math.pow(a.accelerationX,2)+Math.pow(a.accelerationY,2)),n=a,angular.isFunction(i)&&i(n)}},this.end=function(e,t){null!==n&&(angular.isFunction(t)&&t(n),n=null)}}]),t.directive("protonMultiListMotion",["protonMultiListMomentum","$parse",function(e,t){return{restrict:"A",link:function(n,i,a){var l=a.motionChange&&t(a.motionChange),s=a.motionEnd&&t(a.motionEnd),c=a.motionStart&&t(a.motionStart);i.on("mousedown touchstart",function(t){e.start(t,function(e){n.$apply(function(){c&&c(n,{$event:e})})})}),i.on("mousemove touchmove",function(t){e.move(t,function(e){n.$apply(function(){l&&l(n,{$event:e})})})}),i.on("mouseup touchend touchcancel",function(t){e.end(t,function(e){n.$apply(function(){s&&s(n,{$event:e})})})})}}}])}();